<div class="container mt-5 text-center">
  <div class="col-5">
    <h2>Appointment</h2>
    <%= simple_form_for(@patient_appointment, remote: true) do |f| %>
      <%= f.error_notification %>
      <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
      <div id="container">   
        <div class="mb-3">
          
          <%= f.association :doctor, 
            label_method: lambda { |doctor| "#{doctor.name}"},
            :label => "Select Doctor:",
            as: :select, 
            input_html: { class: "value-selector date-select select-doctor" }, 
            item_wrapper_class: 'value-item'
          %>
        </div>
          <%= month_calendar(events: @appointment_dates) do |date, appointment_dates| %>
            <%= content_tag :div, class: "calendar-day", data: {date: date} do %>
              <%= date.day %>
              <% appointment_dates.each do |appointment_date| %>
                <div class="single_event">
                  <%#= link_to appointment_date.doctor.name, appointment_date %>
                </div>
              <% end %>
            <% end %>       
          <% end %>  
        </div>
        <div class="form-actions mt-3">
          <%= f.button :submit, onclick:"send_ajax()", class:"btn btn-primary" %>
        <% end %>
      </div>
  </div>
</div>

<script>
 var doctor;
 var date;

  $( function() {
    $('.date-select').on('select2:select', function (e){
      doctor = e.target.value
      get_ajax(doctor)
    })
  });
  
  $('.calendar-day').on("click", function(e) {
      // date = this.innerText
      date =  e.target.getAttribute('data-date');
  });

  function send_ajax(){
    response = $.ajax({
        url: '/patient_appointments',
        method: 'Post',
        data: {date, doctor}
    });
  }
  
  function get_ajax(doctor){
    response = $.ajax({
        url: '/patient_appointments/new',
        method: 'Get',
        data: {doctor}
    });
  }

  // $(document).on("click", function() {
  //   $('.value-selector').select2({
  //   placeholder: $(this).attr('placeholder')
  //   //placeholder: "Select a doctor"
  //   });
  // });

//   $('.value-item').select2({
//   placeholder: 'Choose One'
// }).val('').trigger('change');

  $(document).ready(function() {
    $('.value-selector').select2({
      placeholder: ""
    });
  });

  $('.has-events').click(function(){
    $('.table-test').find('.active').removeClass('active');
    $(this).addClass('active');
  });

</script>